import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { concatMap, delay, forkJoin, from, map, mergeMap, Observable, of, take, tap, toArray } from 'rxjs';
import { GeoencodingRaw } from 'src/app/shared/models/Geoencoding';
import { GoogleSheetPin } from 'src/app/shared/models/GoogleSheetPin';
import { Vector2 } from 'three';
import { GoogleSheetPinMappingGeoencodingRaw } from 'src/app/shared/models/GoogleSheetPinMappingGeoencodingRaw';
import { GoogleSheetPinMappingLonLat } from 'src/app/shared/models/GoogleSheetPinMappingLonLat';
import { GoogleSheetRawData, GoogleSheetRow } from 'src/app/shared/models/GoogleSheetRawData';
import { GeoencodingCache } from 'src/app/shared/models/GeoencodingCache';
import { CookieService } from 'ngx-cookie-service';
import { environment } from 'src/environments/environment';

@Injectable({
  providedIn: 'root'
})
export class PinsTableService {

  constructor(
    private httpClient: HttpClient,
    private cookieService: CookieService
  ) { }

  getAccessToken = () => this.cookieService.get("accessToken")

  createHeader = () => new HttpHeaders({ "authorization": `Bearer ${this.getAccessToken()}`, 'content-type': 'application/x-www-form-urlencoded'})
  
  getFrontEndUrl = () => environment.useProductionApi ? 'https://us-central1-twgeostat.cloudfunctions.net/getDB' : 'http://localhost:8081'


  getPinLonLatFromGeoencoding = (pins: GoogleSheetPin[]): Observable<GoogleSheetPinMappingLonLat[]> => {
    return of(pins).pipe(
      this.convertAddressToRawGeoencoding,
      this.convertGeoencodingToLonLat
    )
  }

  getAddressFromSourceSheet = (googleSheetId: string): Observable<GoogleSheetPin[]> => {
    const options = {responseType: 'text' as 'json',};
    return this.httpClient.get<GoogleSheetRawData>(`https://docs.google.com/spreadsheets/d/${googleSheetId}/gviz/tq?`, options).pipe(
      this.convertTalbeToGoogleSheetPins,
    )
  }

  convertCacheToLonLat = map( (geoencodingCaches: GeoencodingCache[]): GoogleSheetPinMappingLonLat[] => {
    return geoencodingCaches.map( cache => {
      if (!cache.id) throw new Error("id in the cache is not an number");      
      const pinData =  {
        id: +cache.id,
        address: cache.address,
        title: cache.title
      };
      const lonLat = new Vector2(+cache.lon, +cache.lat)
      return {
        lonLat,
        pinData
      } as GoogleSheetPinMappingLonLat
    })
  })

  getPinsLonLatCache = (): Observable<GoogleSheetPinMappingLonLat[]> => {
    return this.httpClient.get<GeoencodingCache[]>(`${this.getFrontEndUrl()}/address`, { headers: this.createHeader()}).pipe(
      this.convertCacheToLonLat,
    )
  }
  
  convertTalbeToGoogleSheetPins = map((rawdata): GoogleSheetPin[] => {
    rawdata = this.removeExtraText(rawdata as string)    
    const raw = <GoogleSheetRawData>JSON.parse(rawdata as string)    
    const sheetData: GoogleSheetRow[] = raw.table.rows
    const sheetBody: GoogleSheetRow[] = sheetData.filter((row, index) => row.c[0]?.v !== '落點名稱')
    const mapping: GoogleSheetPin[] = this.formatingPointData(sheetBody)
    return mapping
  })

  formatingPointData = (sheetBody: GoogleSheetRow[]):GoogleSheetPin[] => {
    return sheetBody.map((row, index) => {
      let title = ""
      let address = ""
      if (row.c) {
        title = row.c[0].v
        address = row.c[1].v
      }
      return {
        id: index,
        title: title,
        address: address,
      }
    })
  }

  removeExtraText = (text:string) => {
    const tokenToReplaceOnStart = `/*O_o*/\ngoogle.visualization.Query.setResponse(`
    const tokenToReplaceOnend = `);`
    return text.replace(tokenToReplaceOnStart, '').replace(tokenToReplaceOnend, '')
  }

  convertAddressToMockGeoencoding = map( (next: GoogleSheetPin[]):GoogleSheetPinMappingGeoencodingRaw[] => {
    return next.map( (mapData, i) => {
      const mockRaws: GeoencodingRaw[] = [
        {"results":[{"address_components":[{"long_name":"2F","short_name":"2F","types":["subpremise"]},{"long_name":"188號","short_name":"188號","types":["street_number"]},{"long_name":"成功路四段","short_name":"成功路四段","types":["route"]},{"long_name":"內湖里","short_name":"內湖里","types":["administrative_area_level_4","political"]},{"long_name":"內湖區","short_name":"內湖區","types":["administrative_area_level_3","political"]},{"long_name":"台北市","short_name":"台北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"114","short_name":"114","types":["postal_code"]}],"formatted_address":"114台灣台北市內湖區成功路四段188號2F","geometry":{"location":{"lat":25.0839162,"lng":121.5943353},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0851984802915,"lng":121.5957423302915},"southwest":{"lat":25.0825005197085,"lng":121.5930443697085}}},"place_id":"ChIJOwc1We2sQjQRJlsN6Ykwf0Q","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"號 6 樓","short_name":"號 6 樓","types":["subpremise"]},{"long_name":"17","short_name":"17","types":["street_number"]},{"long_name":"松智路","short_name":"松智路","types":["route"]},{"long_name":"西村里","short_name":"西村里","types":["administrative_area_level_4","political"]},{"long_name":"信義區","short_name":"信義區","types":["administrative_area_level_3","political"]},{"long_name":"台北市","short_name":"台北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"110","short_name":"110","types":["postal_code"]}],"formatted_address":"110台灣台北市信義區松智路17號號 6 樓","geometry":{"location":{"lat":25.0344052,"lng":121.567424},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0357532802915,"lng":121.5688362302915},"southwest":{"lat":25.0330553197085,"lng":121.5661382697085}}},"place_id":"ChIJldoY77CrQjQRdgH_ne33Lho","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"台北市","short_name":"台北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]}],"formatted_address":"台灣台北市","geometry":{"bounds":{"northeast":{"lat":25.2103038,"lng":121.6659421},"southwest":{"lat":24.9605084,"lng":121.4570603}},"location":{"lat":25.0329636,"lng":121.5654268},"location_type":"APPROXIMATE","viewport":{"northeast":{"lat":25.2103038,"lng":121.6659421},"southwest":{"lat":24.9605084,"lng":121.4570603}}},"partial_match":true,"place_id":"ChIJi73bYWusQjQRgqQGXK260bw","types":["administrative_area_level_1","political"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"B1","short_name":"B1","types":["subpremise"]},{"long_name":"68號","short_name":"68號","types":["street_number"]},{"long_name":"忠孝東路五段","short_name":"忠孝東路五段","types":["route"]},{"long_name":"興雅里","short_name":"興雅里","types":["administrative_area_level_4","political"]},{"long_name":"信義區","short_name":"信義區","types":["administrative_area_level_3","political"]},{"long_name":"台北市","short_name":"台北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"110","short_name":"110","types":["postal_code"]}],"formatted_address":"B1, No. 68號忠孝東路五段信義區台北市台灣 110","geometry":{"location":{"lat":25.0406017,"lng":121.5670112},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0421696802915,"lng":121.5683668302915},"southwest":{"lat":25.0394717197085,"lng":121.5656688697085}}},"place_id":"ChIJIZiwlLurQjQRduNThJd_3lk","types":["subpremise"]},{"address_components":[{"long_name":"B1","short_name":"B1","types":["subpremise"]},{"long_name":"68號","short_name":"68號","types":["street_number"]},{"long_name":"忠孝東路五段","short_name":"忠孝東路五段","types":["route"]},{"long_name":"興雅里","short_name":"興雅里","types":["administrative_area_level_4","political"]},{"long_name":"信義區","short_name":"信義區","types":["administrative_area_level_3","political"]},{"long_name":"台北市","short_name":"台北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"110","short_name":"110","types":["postal_code"]}],"formatted_address":"B1, No. 68號忠孝東路五段信義區台北市台灣 110","geometry":{"location":{"lat":25.0406017,"lng":121.5670112},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0421696802915,"lng":121.5683668302915},"southwest":{"lat":25.0394717197085,"lng":121.5656688697085}}},"place_id":"ChIJIZiwlLurQjQRduNThJd_3lk","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"2樓","short_name":"2樓","types":["subpremise"]},{"long_name":"3號","short_name":"3號","types":["street_number"]},{"long_name":"北平西路","short_name":"北平西路","types":["route"]},{"long_name":"黎明里","short_name":"黎明里","types":["administrative_area_level_4","political"]},{"long_name":"中正區","short_name":"中正區","types":["administrative_area_level_3","political"]},{"long_name":"台北市","short_name":"台北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"100","short_name":"100","types":["postal_code"]}],"formatted_address":"100台灣台北市中正區北平西路3號2樓","geometry":{"location":{"lat":25.0477467,"lng":121.5169983},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0490956802915,"lng":121.5183472802915},"southwest":{"lat":25.04639771970849,"lng":121.5156493197085}}},"place_id":"ChIJxeVZh3KpQjQR0ESgIfL9Ug0","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"號8樓","short_name":"號8樓","types":["subpremise"]},{"long_name":"12號","short_name":"12號","types":["street_number"]},{"long_name":"南京西路","short_name":"南京西路","types":["route"]},{"long_name":"民安里","short_name":"民安里","types":["administrative_area_level_4","political"]},{"long_name":"中山區","short_name":"中山區","types":["administrative_area_level_3","political"]},{"long_name":"台北市","short_name":"台北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"10491","short_name":"10491","types":["postal_code"]}],"formatted_address":"10491台灣台北市中山區南京西路12號, 號8樓","geometry":{"location":{"lat":25.0523295,"lng":121.5210381},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0537450802915,"lng":121.5224026302915},"southwest":{"lat":25.0510471197085,"lng":121.5197046697085}}},"place_id":"ChIJwZn0tG6pQjQRoZq5OE4obDQ","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"2","short_name":"2","types":["subpremise"]},{"long_name":"133","short_name":"133","types":["street_number"]},{"long_name":"安和路二段","short_name":"安和路二段","types":["route"]},{"long_name":"通安里","short_name":"通安里","types":["administrative_area_level_4","political"]},{"long_name":"大安區","short_name":"大安區","types":["administrative_area_level_3","political"]},{"long_name":"台北市","short_name":"台北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"106","short_name":"106","types":["postal_code"]}],"formatted_address":"106台灣台北市大安區安和路二段133號2","geometry":{"location":{"lat":25.0290777,"lng":121.5511697},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0304823802915,"lng":121.5524596302915},"southwest":{"lat":25.0277844197085,"lng":121.5497616697085}}},"place_id":"EkkyLCBOby4gMTMzLCBTZWN0aW9uIDIsIEFuaGUgUmQsIERh4oCZYW4gRGlzdHJpY3QsIFRhaXBlaSBDaXR5LCBUYWl3YW4gMTA2Ih0aGwoWChQKEgkzSmzWMqpCNBEUut47WTp6fRIBMg","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"12樓","short_name":"12樓","types":["subpremise"]},{"long_name":"66號","short_name":"66號","types":["street_number"]},{"long_name":"忠孝西路一段","short_name":"忠孝西路一段","types":["route"]},{"long_name":"黎明里","short_name":"黎明里","types":["administrative_area_level_4","political"]},{"long_name":"中正區","short_name":"中正區","types":["administrative_area_level_3","political"]},{"long_name":"台北市","short_name":"台北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"100","short_name":"100","types":["postal_code"]}],"formatted_address":"100台灣台北市中正區忠孝西路一段66號12樓","geometry":{"location":{"lat":25.0461864,"lng":121.5153037},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.04777793029151,"lng":121.5167156302915},"southwest":{"lat":25.0450799697085,"lng":121.5140176697085}}},"place_id":"ChIJNyOh3nKpQjQR3hMRuMCqRtA","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"2F","short_name":"2F","types":["subpremise"]},{"long_name":"11號","short_name":"11號","types":["street_number"]},{"long_name":"松山路","short_name":"松山路","types":["route"]},{"long_name":"永吉里","short_name":"永吉里","types":["administrative_area_level_4","political"]},{"long_name":"信义区","short_name":"信义区","types":["administrative_area_level_3","political"]},{"long_name":"台北市","short_name":"台北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"110","short_name":"110","types":["postal_code"]}],"formatted_address":"110台灣台北市信义区松山路11號2F","geometry":{"location":{"lat":25.0493031,"lng":121.5786215},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0506370302915,"lng":121.5795802802915},"southwest":{"lat":25.0479390697085,"lng":121.5768823197085}}},"place_id":"ChIJU_Dunp6rQjQRNnLLkn2zaAc","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"8樓C棟","short_name":"8樓C棟","types":["subpremise"]},{"long_name":"369號","short_name":"369號","types":["street_number"]},{"long_name":"忠孝東路七段","short_name":"忠孝東路七段","types":["route"]},{"long_name":"東明里","short_name":"東明里","types":["administrative_area_level_4","political"]},{"long_name":"南港區","short_name":"南港區","types":["administrative_area_level_3","political"]},{"long_name":"台北市","short_name":"台北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"11561","short_name":"11561","types":["postal_code"]}],"formatted_address":"11561台灣台北市南港區忠孝東路七段369號8樓C棟","geometry":{"location":{"lat":25.0525582,"lng":121.604518},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0535651302915,"lng":121.6059169302915},"southwest":{"lat":25.0508671697085,"lng":121.6032189697085}}},"place_id":"ChIJl_iiaWerQjQRR0aKhzskskE","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"246","short_name":"246","types":["street_number"]},{"long_name":"內湖路一段","short_name":"內湖路一段","types":["route"]},{"long_name":"西湖里","short_name":"西湖里","types":["administrative_area_level_4","political"]},{"long_name":"內湖區","short_name":"內湖區","types":["administrative_area_level_3","political"]},{"long_name":"台北市","short_name":"台北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"114","short_name":"114","types":["postal_code"]}],"formatted_address":"114台灣台北市內湖區內湖路一段246號","geometry":{"location":{"lat":25.0818438,"lng":121.5661028},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0833526802915,"lng":121.5675359802915},"southwest":{"lat":25.08065471970849,"lng":121.5648380197085}}},"place_id":"ChIJa8jNhW6sQjQRi5t_-Qy2KGs","plus_code":{"compound_code":"3HJ8+PC 台灣台北市內湖區","global_code":"7QQ33HJ8+PC"},"types":["street_address"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"a 7","short_name":"a 7","types":["subpremise"]},{"long_name":"68","short_name":"68","types":["street_number"]},{"long_name":"天母東路","short_name":"天母東路","types":["route"]},{"long_name":"天福里","short_name":"天福里","types":["administrative_area_level_4","political"]},{"long_name":"士林區","short_name":"士林區","types":["administrative_area_level_3","political"]},{"long_name":"台北市","short_name":"台北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"111","short_name":"111","types":["postal_code"]}],"formatted_address":"111台灣台北市士林區天母東路68號a 7","geometry":{"bounds":{"northeast":{"lat":25.1179579,"lng":121.5343171},"southwest":{"lat":25.1175992,"lng":121.5336029}},"location":{"lat":25.1178315,"lng":121.5338781},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.1191712802915,"lng":121.5353089802915},"southwest":{"lat":25.11647331970849,"lng":121.5326110197085}}},"place_id":"EkJhIDcsIE5vLiA2OCwgVGlhbm11IEUgUmQsIFNoaWxpbiBEaXN0cmljdCwgVGFpcGVpIENpdHksIFRhaXdhbiAxMTEiHxodChYKFAoSCaNZRYaArkI0Eeaf26ojTurbEgNhIDc","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"654","short_name":"654","types":["street_number"]},{"long_name":"重新路五段","short_name":"重新路五段","types":["route"]},{"long_name":"中興里","short_name":"中興里","types":["administrative_area_level_4","political"]},{"long_name":"三重區","short_name":"三重區","types":["administrative_area_level_3","political"]},{"long_name":"新北市","short_name":"新北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"241","short_name":"241","types":["postal_code"]}],"formatted_address":"241台灣新北市三重區重新路五段654號","geometry":{"location":{"lat":25.0432729,"lng":121.4675175},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0447271802915,"lng":121.4687456802915},"southwest":{"lat":25.0420292197085,"lng":121.4660477197085}}},"place_id":"ChIJ0QMaT2eoQjQRA5ZdsLV7k0c","plus_code":{"compound_code":"2FV9+82 台灣新北市三重區","global_code":"7QQ32FV9+82"},"types":["street_address"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"號7F","short_name":"號7F","types":["subpremise"]},{"long_name":"40-6","short_name":"40-6","types":["street_number"]},{"long_name":"樹新路","short_name":"樹新路","types":["route"]},{"long_name":"保安里","short_name":"保安里","types":["administrative_area_level_4","political"]},{"long_name":"樹林區","short_name":"樹林區","types":["administrative_area_level_3","political"]},{"long_name":"新北市","short_name":"新北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"23847","short_name":"23847","types":["postal_code"]}],"formatted_address":"23847台灣新北市樹林區樹新路40-6號號7F","geometry":{"location":{"lat":24.9955124,"lng":121.4284262},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.9970065302915,"lng":121.4295582302915},"southwest":{"lat":24.9943085697085,"lng":121.4268602697085}}},"place_id":"ChIJUfJHs0AdaDQRC10LVyZZHYc","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"10樓","short_name":"10樓","types":["subpremise"]},{"long_name":"8號","short_name":"8號","types":["street_number"]},{"long_name":"中山路","short_name":"中山路","types":["route"]},{"long_name":"長庚里","short_name":"長庚里","types":["administrative_area_level_4","political"]},{"long_name":"淡水區","short_name":"淡水區","types":["administrative_area_level_3","political"]},{"long_name":"新北市","short_name":"新北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"251","short_name":"251","types":["postal_code"]}],"formatted_address":"251台灣新北市淡水區中山路8號10樓","geometry":{"location":{"lat":25.1691131,"lng":121.444993},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.1704620802915,"lng":121.4463419802915},"southwest":{"lat":25.1677641197085,"lng":121.4436440197085}}},"place_id":"ChIJVVWVelilQjQRhrC7o221jDk","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"111","short_name":"111","types":["street_number"]},{"long_name":"天母西路","short_name":"天母西路","types":["route"]},{"long_name":"永欣里","short_name":"永欣里","types":["administrative_area_level_4","political"]},{"long_name":"北投區","short_name":"北投區","types":["administrative_area_level_3","political"]},{"long_name":"台北市","short_name":"台北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"112","short_name":"112","types":["postal_code"]}],"formatted_address":"112台灣台北市北投區天母西路111號","geometry":{"location":{"lat":25.1189355,"lng":121.5234462},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.12023023029151,"lng":121.5247750302915},"southwest":{"lat":25.11753226970851,"lng":121.5220770697085}}},"place_id":"ChIJ_3z3T4iuQjQRy6U6pRKhUzU","plus_code":{"compound_code":"4G9F+H9 台灣台北市北投區","global_code":"7QQ34G9F+H9"},"types":["street_address"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"2樓","short_name":"2樓","types":["subpremise"]},{"long_name":"356號","short_name":"356號","types":["street_number"]},{"long_name":"文化三路一段","short_name":"文化三路一段","types":["route"]},{"long_name":"南勢里","short_name":"南勢里","types":["administrative_area_level_4","political"]},{"long_name":"林口區","short_name":"林口區","types":["administrative_area_level_3","political"]},{"long_name":"新北市","short_name":"新北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"244","short_name":"244","types":["postal_code"]}],"formatted_address":"244台灣新北市林口區文化三路一段356號2樓","geometry":{"location":{"lat":25.0707927,"lng":121.364181},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0724083802915,"lng":121.3651821802915},"southwest":{"lat":25.0697104197085,"lng":121.3624842197085}}},"place_id":"ChIJIVV0YCinQjQRS_ncy889ySU","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"95","short_name":"95","types":["street_number"]},{"long_name":"正義北路","short_name":"正義北路","types":["route"]},{"long_name":"文化里","short_name":"文化里","types":["administrative_area_level_4","political"]},{"long_name":"三重區","short_name":"三重區","types":["administrative_area_level_3","political"]},{"long_name":"新北市","short_name":"新北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"241","short_name":"241","types":["postal_code"]}],"formatted_address":"241台灣新北市三重區正義北路95號","geometry":{"location":{"lat":25.0653023,"lng":121.497147},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0666305302915,"lng":121.4984099802915},"southwest":{"lat":25.06393256970849,"lng":121.4957120197085}}},"place_id":"ChIJIY24JyKpQjQRVfJqhLTo7Q8","plus_code":{"compound_code":"3F8W+4V 台灣新北市三重區","global_code":"7QQ33F8W+4V"},"types":["street_address"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"2","short_name":"2","types":["subpremise"]},{"long_name":"750","short_name":"750","types":["street_number"]},{"long_name":"幸福路","short_name":"幸福路","types":["route"]},{"long_name":"中港里","short_name":"中港里","types":["administrative_area_level_4","political"]},{"long_name":"新莊區","short_name":"新莊區","types":["administrative_area_level_3","political"]},{"long_name":"新北市","short_name":"新北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"242","short_name":"242","types":["postal_code"]}],"formatted_address":"242台灣新北市新莊區幸福路750號2","geometry":{"location":{"lat":25.0492352,"lng":121.4478086},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0505196302915,"lng":121.4491590802915},"southwest":{"lat":25.0478216697085,"lng":121.4464611197085}}},"place_id":"EkYyLCBOby4gNzUwLCBYaW5nZnUgUmQsIFhpbnpodWFuZyBEaXN0cmljdCwgTmV3IFRhaXBlaSBDaXR5LCBUYWl3YW4gMjQyIh0aGwoWChQKEgkDlzolf6hCNBEPOx3PyUmnAxIBMg","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"2樓","short_name":"2樓","types":["subpremise"]},{"long_name":"22號","short_name":"22號","types":["street_number"]},{"long_name":"敬業三路","short_name":"敬業三路","types":["route"]},{"long_name":"大直","short_name":"大直","types":["neighborhood","political"]},{"long_name":"金泰里","short_name":"金泰里","types":["administrative_area_level_4","political"]},{"long_name":"中山區","short_name":"中山區","types":["administrative_area_level_3","political"]},{"long_name":"台北市","short_name":"台北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"104","short_name":"104","types":["postal_code"]}],"formatted_address":"104台灣台北市中山區敬業三路22號2樓","geometry":{"location":{"lat":25.0836504,"lng":121.5571597},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0850003302915,"lng":121.5581201802915},"southwest":{"lat":25.0823023697085,"lng":121.5554222197085}}},"partial_match":true,"place_id":"ChIJpU1L_hKsQjQRaev35ZVH1xc","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"179","short_name":"179","types":["street_number"]},{"long_name":"建一路","short_name":"建一路","types":["route"]},{"long_name":"平河里","short_name":"平河里","types":["administrative_area_level_4","political"]},{"long_name":"中和區","short_name":"中和區","types":["administrative_area_level_3","political"]},{"long_name":"新北市","short_name":"新北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"235","short_name":"235","types":["postal_code"]}],"formatted_address":"235台灣新北市中和區建一路179號","geometry":{"location":{"lat":24.9986781,"lng":121.4883472},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0000247802915,"lng":121.4896180802915},"southwest":{"lat":24.9973268197085,"lng":121.4869201197085}}},"place_id":"ChIJH0cdA4ECaDQRG4qAF6QItYw","plus_code":{"compound_code":"XFXQ+F8 台灣新北市中和區","global_code":"7QP3XFXQ+F8"},"types":["street_address"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"65","short_name":"65","types":["street_number"]},{"long_name":"文化路一段","short_name":"文化路一段","types":["route"]},{"long_name":"漢生里","short_name":"漢生里","types":["administrative_area_level_4","political"]},{"long_name":"板橋區","short_name":"板橋區","types":["administrative_area_level_3","political"]},{"long_name":"新北市","short_name":"新北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"220","short_name":"220","types":["postal_code"]}],"formatted_address":"220台灣新北市板橋區文化路一段65號","geometry":{"location":{"lat":25.0138111,"lng":121.4608474},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0151263802915,"lng":121.4622463802915},"southwest":{"lat":25.0124284197085,"lng":121.4595484197085}}},"place_id":"ChIJzydCiRuoQjQR6Y2CVb9oIz0","plus_code":{"compound_code":"2F76+G8 台灣新北市板橋區","global_code":"7QQ32F76+G8"},"types":["street_address"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"13樓","short_name":"13樓","types":["subpremise"]},{"long_name":"152號","short_name":"152號","types":["street_number"]},{"long_name":"中山路一段","short_name":"中山路一段","types":["route"]},{"long_name":"深丘里","short_name":"深丘里","types":["administrative_area_level_4","political"]},{"long_name":"板橋區","short_name":"板橋區","types":["administrative_area_level_3","political"]},{"long_name":"新北市","short_name":"新北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"220","short_name":"220","types":["postal_code"]}],"formatted_address":"220台灣新北市板橋區中山路一段152號13樓","geometry":{"location":{"lat":25.0109769,"lng":121.4644504},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0124680802915,"lng":121.4657169302915},"southwest":{"lat":25.0097701197085,"lng":121.4630189697085}}},"place_id":"ChIJt0dr7B6oQjQRzASO1u71hYM","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"1樓","short_name":"1樓","types":["subpremise"]},{"long_name":"99號","short_name":"99號","types":["street_number"]},{"long_name":"新台五路一段","short_name":"新台五路一段","types":["route"]},{"long_name":"忠孝里","short_name":"忠孝里","types":["administrative_area_level_4","political"]},{"long_name":"汐止區","short_name":"汐止區","types":["administrative_area_level_3","political"]},{"long_name":"新北市","short_name":"新北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"22175","short_name":"22175","types":["postal_code"]}],"formatted_address":"22175台灣新北市汐止區新台五路一段99號1樓","geometry":{"location":{"lat":25.0620419,"lng":121.6485728},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0630346802915,"lng":121.6499746802915},"southwest":{"lat":25.0603367197085,"lng":121.6472767197085}}},"place_id":"ChIJeSQ7_0JTXTQRLeLueBME4A8","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"2樓","short_name":"2樓","types":["subpremise"]},{"long_name":"8號","short_name":"8號","types":["street_number"]},{"long_name":"復興一路","short_name":"復興一路","types":["route"]},{"long_name":"公西里","short_name":"公西里","types":["administrative_area_level_4","political"]},{"long_name":"龜山區","short_name":"龜山區","types":["administrative_area_level_3","political"]},{"long_name":"桃園市","short_name":"桃園市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"333","short_name":"333","types":["postal_code"]}],"formatted_address":"333台灣桃園市龜山區復興一路8號, 2樓","geometry":{"location":{"lat":25.0603021,"lng":121.3697947},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0617571302915,"lng":121.3710611802915},"southwest":{"lat":25.0590591697085,"lng":121.3683632197085}}},"place_id":"ChIJbboSPzunQjQRutkxZx-aOj8","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"6樓號","short_name":"6樓號","types":["subpremise"]},{"long_name":"112號","short_name":"112號","types":["street_number"]},{"long_name":"南崁路一段","short_name":"南崁路一段","types":["route"]},{"long_name":"錦中里","short_name":"錦中里","types":["administrative_area_level_4","political"]},{"long_name":"蘆竹區","short_name":"蘆竹區","types":["administrative_area_level_3","political"]},{"long_name":"桃園市","short_name":"桃園市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"338","short_name":"338","types":["postal_code"]}],"formatted_address":"338台灣桃園市蘆竹區南崁路一段112號6樓號","geometry":{"location":{"lat":25.0533369,"lng":121.2877693},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0545796802915,"lng":121.2890222302915},"southwest":{"lat":25.05188171970849,"lng":121.2863242697085}}},"place_id":"ChIJbQKLj3SgQjQRAjF42F1zC1M","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"2樓","short_name":"2樓","types":["subpremise"]},{"long_name":"107號","short_name":"107號","types":["street_number"]},{"long_name":"春德路","short_name":"春德路","types":["route"]},{"long_name":"2鄰","short_name":"2鄰","types":["neighborhood","political"]},{"long_name":"中壢區","short_name":"中壢區","types":["administrative_area_level_3","political"]},{"long_name":"桃園市","short_name":"桃園市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"320","short_name":"320","types":["postal_code"]}],"formatted_address":"320台灣桃園市中壢區春德路107號2樓","geometry":{"location":{"lat":25.0168255,"lng":121.2133654},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0180665802915,"lng":121.2144580802915},"southwest":{"lat":25.0153686197085,"lng":121.2117601197085}}},"partial_match":true,"place_id":"ChIJveOK5wYhaDQR4r5X8be8mj8","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"2","short_name":"2","types":["subpremise"]},{"long_name":"116號","short_name":"116號","types":["street_number"]},{"long_name":"永和路二段","short_name":"永和路二段","types":["route"]},{"long_name":"正興里","short_name":"正興里","types":["administrative_area_level_4","political"]},{"long_name":"永和區","short_name":"永和區","types":["administrative_area_level_3","political"]},{"long_name":"新北市","short_name":"新北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"234","short_name":"234","types":["postal_code"]}],"formatted_address":"234台灣新北市永和區永和路二段116號2","geometry":{"location":{"lat":25.0120873,"lng":121.5152146},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0134478302915,"lng":121.5165169802915},"southwest":{"lat":25.01074986970849,"lng":121.5138190197085}}},"place_id":"ChIJiRmyEOqpQjQRrS4CL07ig7Y","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"2","short_name":"2","types":["subpremise"]},{"long_name":"268","short_name":"268","types":["street_number"]},{"long_name":"建國路","short_name":"建國路","types":["route"]},{"long_name":"復興里","short_name":"復興里","types":["administrative_area_level_4","political"]},{"long_name":"新店區","short_name":"新店區","types":["administrative_area_level_3","political"]},{"long_name":"新北市","short_name":"新北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"231","short_name":"231","types":["postal_code"]}],"formatted_address":"231台灣新北市新店區建國路268號2","geometry":{"bounds":{"northeast":{"lat":24.9835858,"lng":121.5380182},"southwest":{"lat":24.9830411,"lng":121.5375051}},"location":{"lat":24.983287,"lng":121.5376693},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.9846624302915,"lng":121.5391106302915},"southwest":{"lat":24.98196446970849,"lng":121.5364126697085}}},"place_id":"EkUyLCBOby4gMjY4LCBKaWFuZ3VvIFJkLCBYaW5kaWFuIERpc3RyaWN0LCBOZXcgVGFpcGVpIENpdHksIFRhaXdhbiAyMzEiHRobChYKFAoSCRt5I5f4AWg0Ebj-Rxke6ziTEgEy","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"4樓","short_name":"4樓","types":["subpremise"]},{"long_name":"122號","short_name":"122號","types":["street_number"]},{"long_name":"中山路三段","short_name":"中山路三段","types":["route"]},{"long_name":"員山里","short_name":"員山里","types":["administrative_area_level_4","political"]},{"long_name":"中和區","short_name":"中和區","types":["administrative_area_level_3","political"]},{"long_name":"新北市","short_name":"新北市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"235","short_name":"235","types":["postal_code"]}],"formatted_address":"235台灣新北市中和區中山路三段122號4樓","geometry":{"location":{"lat":25.0069668,"lng":121.4749549},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0083525302915,"lng":121.4765074302915},"southwest":{"lat":25.0056545697085,"lng":121.4738094697085}}},"place_id":"ChIJQZpFJSeoQjQRIE5L-OC8LwE","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"10樓","short_name":"10樓","types":["subpremise"]},{"long_name":"19號","short_name":"19號","types":["street_number"]},{"long_name":"中正路","short_name":"中正路","types":["route"]},{"long_name":"文化里","short_name":"文化里","types":["administrative_area_level_4","political"]},{"long_name":"桃園區","short_name":"桃園區","types":["administrative_area_level_3","political"]},{"long_name":"桃園市","short_name":"桃園市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"330","short_name":"330","types":["postal_code"]}],"formatted_address":"330台灣桃園市桃園區中正路19號10樓","geometry":{"location":{"lat":24.9899878,"lng":121.312985},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.9913646302915,"lng":121.3144297802915},"southwest":{"lat":24.9886666697085,"lng":121.3117318197085}}},"place_id":"ChIJlUYZtPweaDQRiK2UAlL3OCg","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"4樓","short_name":"4樓","types":["subpremise"]},{"long_name":"509號","short_name":"509號","types":["street_number"]},{"long_name":"中園路二段","short_name":"中園路二段","types":["route"]},{"long_name":"永福里","short_name":"永福里","types":["administrative_area_level_4","political"]},{"long_name":"中壢區","short_name":"中壢區","types":["administrative_area_level_3","political"]},{"long_name":"桃園市","short_name":"桃園市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"320","short_name":"320","types":["postal_code"]}],"formatted_address":"320台灣桃園市中壢區中園路二段509號4樓","geometry":{"location":{"lat":25.0016584,"lng":121.2289405},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0030473802915,"lng":121.2305134302915},"southwest":{"lat":25.0003494197085,"lng":121.2278154697085}}},"place_id":"ChIJp4m-0LwhaDQRs8-QnYit1YM","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"8樓","short_name":"8樓","types":["subpremise"]},{"long_name":"189號","short_name":"189號","types":["street_number"]},{"long_name":"大有路","short_name":"大有路","types":["route"]},{"long_name":"三元里","short_name":"三元里","types":["administrative_area_level_4","political"]},{"long_name":"桃園區","short_name":"桃園區","types":["administrative_area_level_3","political"]},{"long_name":"桃園市","short_name":"桃園市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"330","short_name":"330","types":["postal_code"]}],"formatted_address":"330台灣桃園市桃園區大有路189號8樓","geometry":{"location":{"lat":25.0082097,"lng":121.3200167},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0096167302915,"lng":121.3215557302915},"southwest":{"lat":25.00691876970849,"lng":121.3188577697085}}},"place_id":"ChIJdVjgoFoeaDQRGhy3fimuci4","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"2","short_name":"2","types":["subpremise"]},{"long_name":"370","short_name":"370","types":["street_number"]},{"long_name":"南平路","short_name":"南平路","types":["route"]},{"long_name":"同德里","short_name":"同德里","types":["administrative_area_level_4","political"]},{"long_name":"桃園區","short_name":"桃園區","types":["administrative_area_level_3","political"]},{"long_name":"桃園市","short_name":"桃園市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"330","short_name":"330","types":["postal_code"]}],"formatted_address":"330台灣桃園市桃園區南平路370號2","geometry":{"location":{"lat":25.0178346,"lng":121.2971188},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":25.0191062302915,"lng":121.2985090802915},"southwest":{"lat":25.0164082697085,"lng":121.2958111197085}}},"place_id":"EkIyLCBOby4gMzcwLCBOYW5waW5nIFJkLCBUYW95dWFuIERpc3RyaWN0LCBUYW95dWFuIENpdHksIFRhaXdhbiAzMzAiHRobChYKFAoSCdG_5IKwH2g0ETelqkHwLXqSEgEy","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"187","short_name":"187","types":["street_number"]},{"long_name":"光明一路","short_name":"光明一路","types":["route"]},{"long_name":"十興里","short_name":"十興里","types":["administrative_area_level_4","political"]},{"long_name":"竹北市","short_name":"竹北市","types":["administrative_area_level_3","political"]},{"long_name":"新竹縣","short_name":"新竹縣","types":["administrative_area_level_2","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"302","short_name":"302","types":["postal_code"]}],"formatted_address":"302台灣新竹縣竹北市光明一路187號","geometry":{"location":{"lat":24.8304182,"lng":121.0141923},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.8318522302915,"lng":121.0155544302915},"southwest":{"lat":24.8291542697085,"lng":121.0128564697085}}},"place_id":"ChIJ43jtj-s2aDQRY13Fd-ZNIMs","plus_code":{"compound_code":"R2J7+5M 台灣新竹縣竹北市","global_code":"7QP3R2J7+5M"},"types":["street_address"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"88","short_name":"88","types":["street_number"]},{"long_name":"金山街","short_name":"金山街","types":["route"]},{"long_name":"金山里","short_name":"金山里","types":["administrative_area_level_4","political"]},{"long_name":"東區","short_name":"東區","types":["administrative_area_level_3","political"]},{"long_name":"新竹市","short_name":"新竹市","types":["administrative_area_level_2","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"300","short_name":"300","types":["postal_code"]}],"formatted_address":"300台灣新竹市東區金山街88號","geometry":{"location":{"lat":24.7772467,"lng":121.0228901},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.7786418302915,"lng":121.0242683802915},"southwest":{"lat":24.7759438697085,"lng":121.0215704197085}}},"place_id":"ChIJD3fFdy82aDQR46sphT2iiIY","plus_code":{"compound_code":"Q2GF+V5 台灣新竹市東區","global_code":"7QP3Q2GF+V5"},"types":["street_address"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"7F","short_name":"7F","types":["subpremise"]},{"long_name":"229號","short_name":"229號","types":["street_number"]},{"long_name":"中央路","short_name":"中央路","types":["route"]},{"long_name":"復中里","short_name":"復中里","types":["administrative_area_level_4","political"]},{"long_name":"東區","short_name":"東區","types":["administrative_area_level_3","political"]},{"long_name":"新竹市","short_name":"新竹市","types":["administrative_area_level_2","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"300","short_name":"300","types":["postal_code"]}],"formatted_address":"300台灣新竹市東區中央路229號7F","geometry":{"location":{"lat":24.8094355,"lng":120.9749907},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.8106208802915,"lng":120.9764046802915},"southwest":{"lat":24.8079229197085,"lng":120.9737067197085}}},"place_id":"ChIJzUUf38Q1aDQReAJtTJGS_jQ","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"8F","short_name":"8F","types":["subpremise"]},{"long_name":"357號","short_name":"357號","types":["street_number"]},{"long_name":"元化路","short_name":"元化路","types":["route"]},{"long_name":"金華里","short_name":"金華里","types":["administrative_area_level_4","political"]},{"long_name":"中壢區","short_name":"中壢區","types":["administrative_area_level_3","political"]},{"long_name":"桃園市","short_name":"桃園市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"320","short_name":"320","types":["postal_code"]}],"formatted_address":"320台灣桃園市中壢區元化路357號8F","geometry":{"location":{"lat":24.9626852,"lng":121.2238578},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.9638296302915,"lng":121.2251678802915},"southwest":{"lat":24.9611316697085,"lng":121.2224699197085}}},"place_id":"ChIJIf36SjEiaDQRnsQZpQIcm-U","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"2","short_name":"2","types":["subpremise"]},{"long_name":"79","short_name":"79","types":["street_number"]},{"long_name":"關新路","short_name":"關新路","types":["route"]},{"long_name":"新莊里","short_name":"新莊里","types":["administrative_area_level_4","political"]},{"long_name":"東區","short_name":"東區","types":["administrative_area_level_3","political"]},{"long_name":"新竹市","short_name":"新竹市","types":["administrative_area_level_2","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"300","short_name":"300","types":["postal_code"]}],"formatted_address":"300台灣新竹市東區關新路79號2","geometry":{"location":{"lat":24.7867199,"lng":121.0189641},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.7880416302915,"lng":121.0203776802915},"southwest":{"lat":24.7853436697085,"lng":121.0176797197085}}},"place_id":"Ej4yLCBOby4gNzksIEd1YW54aW4gUmQsIEVhc3QgRGlzdHJpY3QsIEhzaW5jaHUgQ2l0eSwgVGFpd2FuIDMwMCIdGhsKFgoUChIJcSKpeTk2aDQRicyLrU_N__oSATI","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"B-1","short_name":"B-1","types":["subpremise"]},{"long_name":"91-2號","short_name":"91-2號","types":["street_number"]},{"long_name":"湳雅街","short_name":"湳雅街","types":["route"]},{"long_name":"湳雅里","short_name":"湳雅里","types":["administrative_area_level_4","political"]},{"long_name":"北區","short_name":"北區","types":["administrative_area_level_3","political"]},{"long_name":"新竹市","short_name":"新竹市","types":["administrative_area_level_2","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"300","short_name":"300","types":["postal_code"]}],"formatted_address":"300台灣新竹市北區湳雅街91-2號B-1","geometry":{"location":{"lat":24.8193117,"lng":120.9695793},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.8205748302915,"lng":120.9708238302915},"southwest":{"lat":24.8178768697085,"lng":120.9681258697085}}},"place_id":"ChIJH5Hi5Ms1aDQRklEfsw_7dh4","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"頭份","short_name":"頭份","types":["colloquial_area","locality","political"]},{"long_name":"頭份市","short_name":"頭份市","types":["administrative_area_level_3","political"]},{"long_name":"苗栗縣","short_name":"苗栗縣","types":["administrative_area_level_2","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]}],"formatted_address":"台灣苗栗縣頭份市頭份","geometry":{"bounds":{"northeast":{"lat":24.7032653,"lng":120.9721581},"southwest":{"lat":24.630135,"lng":120.8763}},"location":{"lat":24.6884438,"lng":120.9024836},"location_type":"APPROXIMATE","viewport":{"northeast":{"lat":24.7032653,"lng":120.9721581},"southwest":{"lat":24.630135,"lng":120.8763}}},"partial_match":true,"place_id":"ChIJC61tyLZMaDQRw3ZNvdg54pU","types":["colloquial_area","locality","political"]},{"address_components":[{"long_name":"育樂街","short_name":"育樂街","types":["route"]},{"long_name":"桃園區","short_name":"桃園區","types":["administrative_area_level_3","political"]},{"long_name":"桃園市","short_name":"桃園市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"330","short_name":"330","types":["postal_code"]}],"formatted_address":"330台灣桃園市桃園區育樂街","geometry":{"bounds":{"northeast":{"lat":24.9932393,"lng":121.3046547},"southwest":{"lat":24.9904168,"lng":121.3032246}},"location":{"lat":24.991568,"lng":121.3039857},"location_type":"GEOMETRIC_CENTER","viewport":{"northeast":{"lat":24.9932393,"lng":121.3052886302915},"southwest":{"lat":24.9904168,"lng":121.3025906697085}}},"partial_match":true,"place_id":"ChIJ-bE6SwMfaDQRsVV6EfshSzI","types":["route"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"2樓","short_name":"2樓","types":["subpremise"]},{"long_name":"459號","short_name":"459號","types":["street_number"]},{"long_name":"台灣大道二段","short_name":"台灣大道二段","types":["route"]},{"long_name":"忠明里","short_name":"忠明里","types":["administrative_area_level_4","political"]},{"long_name":"西屯區","short_name":"西屯區","types":["administrative_area_level_3","political"]},{"long_name":"台中市","short_name":"台中市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"407","short_name":"407","types":["postal_code"]}],"formatted_address":"407台灣台中市西屯區台灣大道二段459號2樓","geometry":{"location":{"lat":24.1554814,"lng":120.6617291},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.1569434802915,"lng":120.6631533802915},"southwest":{"lat":24.1542455197085,"lng":120.6604554197085}}},"place_id":"ChIJ1TsNwJw9aTQRtjXzkKyHZmI","types":["subpremise"]},{"address_components":[{"long_name":"2樓","short_name":"2樓","types":["subpremise"]},{"long_name":"459號","short_name":"459號","types":["street_number"]},{"long_name":"台灣大道二段","short_name":"台灣大道二段","types":["route"]},{"long_name":"忠明里","short_name":"忠明里","types":["administrative_area_level_4","political"]},{"long_name":"西屯區","short_name":"西屯區","types":["administrative_area_level_3","political"]},{"long_name":"台中市","short_name":"台中市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"407","short_name":"407","types":["postal_code"]}],"formatted_address":"407台灣台中市西屯區台灣大道二段459號2樓","geometry":{"location":{"lat":24.1554814,"lng":120.6617291},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.1569434802915,"lng":120.6631533802915},"southwest":{"lat":24.1542455197085,"lng":120.6604554197085}}},"place_id":"ChIJ1TsNwJw9aTQRtjXzkKyHZmI","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"1樓","short_name":"1樓","types":["subpremise"]},{"long_name":"麗寶outlet","short_name":"麗寶outlet","types":["establishment","point_of_interest"]},{"long_name":"201號","short_name":"201號","types":["street_number"]},{"long_name":"福容路","short_name":"福容路","types":["route"]},{"long_name":"月眉里","short_name":"月眉里","types":["administrative_area_level_4","political"]},{"long_name":"后里區","short_name":"后里區","types":["administrative_area_level_3","political"]},{"long_name":"台中市","short_name":"台中市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"421","short_name":"421","types":["postal_code"]}],"formatted_address":"421台灣台中市后里區福容路201號麗寶outlet1樓","geometry":{"location":{"lat":24.3242977,"lng":120.6991781},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.3255230802915,"lng":120.7006030302915},"southwest":{"lat":24.3228251197085,"lng":120.6979050697085}}},"place_id":"ChIJDSYMXRsQaTQRgg0hECx2DSg","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"B1樓","short_name":"B1樓","types":["subpremise"]},{"long_name":"68號","short_name":"68號","types":["street_number"]},{"long_name":"公益路","short_name":"公益路","types":["route"]},{"long_name":"民龍里","short_name":"民龍里","types":["administrative_area_level_4","political"]},{"long_name":"西區","short_name":"西區","types":["administrative_area_level_3","political"]},{"long_name":"台中市","short_name":"台中市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"403","short_name":"403","types":["postal_code"]}],"formatted_address":"403台灣台中市西區公益路68號B1樓","geometry":{"location":{"lat":24.15104,"lng":120.663848},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.1522988802915,"lng":120.6651961302915},"southwest":{"lat":24.1496009197085,"lng":120.6624981697085}}},"place_id":"ChIJzYkn2J09aTQRImXVkRTz7yU","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"3樓","short_name":"3樓","types":["subpremise"]},{"long_name":"299號","short_name":"299號","types":["street_number"]},{"long_name":"文化路","short_name":"文化路","types":["route"]},{"long_name":"湖邊里","short_name":"湖邊里","types":["administrative_area_level_4","political"]},{"long_name":"西區","short_name":"西區","types":["administrative_area_level_3","political"]},{"long_name":"嘉義市","short_name":"嘉義市","types":["administrative_area_level_2","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"600","short_name":"600","types":["postal_code"]}],"formatted_address":"600台灣嘉義市西區文化路299號3樓","geometry":{"location":{"lat":23.4853918,"lng":120.44777},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":23.4867891802915,"lng":120.4492621302915},"southwest":{"lat":23.4840912197085,"lng":120.4465641697085}}},"place_id":"ChIJDyyIpTKUbjQRDM5_eiaqKlc","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"4樓","short_name":"4樓","types":["subpremise"]},{"long_name":"186號","short_name":"186號","types":["street_number"]},{"long_name":"復興路四段","short_name":"復興路四段","types":["route"]},{"long_name":"新庄里","short_name":"新庄里","types":["administrative_area_level_4","political"]},{"long_name":"東區","short_name":"東區","types":["administrative_area_level_3","political"]},{"long_name":"台中市","short_name":"台中市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"401","short_name":"401","types":["postal_code"]}],"formatted_address":"401台灣台中市東區復興路四段186號4樓","geometry":{"location":{"lat":24.1361012,"lng":120.6876041},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.1375520802915,"lng":120.6889023802915},"southwest":{"lat":24.1348541197085,"lng":120.6862044197085}}},"place_id":"ChIJvY166hU9aTQRtd0OCobYLM8","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"3F","short_name":"3F","types":["subpremise"]},{"long_name":"210","short_name":"210","types":["street_number"]},{"long_name":"前鋒路","short_name":"前鋒路","types":["route"]},{"long_name":"成大里","short_name":"成大里","types":["administrative_area_level_4","political"]},{"long_name":"東區","short_name":"東區","types":["administrative_area_level_3","political"]},{"long_name":"台南市","short_name":"台南市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"701","short_name":"701","types":["postal_code"]}],"formatted_address":"701台灣台南市東區前鋒路210號3F","geometry":{"location":{"lat":22.9963247,"lng":120.2143364},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":22.9977342302915,"lng":120.2152744302915},"southwest":{"lat":22.9950362697085,"lng":120.2125764697085}}},"place_id":"ChIJVTxOqI12bjQR1Umf_fLrQ1I","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"a 12","short_name":"a 12","types":["subpremise"]},{"long_name":"161-4號","short_name":"161-4號","types":["street_number"]},{"long_name":"三民路三段","short_name":"三民路三段","types":["route"]},{"long_name":"錦平里","short_name":"錦平里","types":["administrative_area_level_4","political"]},{"long_name":"北區","short_name":"北區","types":["administrative_area_level_3","political"]},{"long_name":"台中市","short_name":"台中市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"404","short_name":"404","types":["postal_code"]}],"formatted_address":"404台灣台中市北區三民路三段161-4號a 12","geometry":{"location":{"lat":24.1522437,"lng":120.6848058},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.1535551302915,"lng":120.6862677302915},"southwest":{"lat":24.1508571697085,"lng":120.6835697697085}}},"place_id":"ElNhIDEyLCBOby4gMTYxLTTomZ8sIFNlY3Rpb24gMywgU2FubWluIFJkLCBOb3J0aCBEaXN0cmljdCwgVGFpY2h1bmcgQ2l0eSwgVGFpd2FuIDQwNCIgGh4KFgoUChIJN9XFImY9aTQRoeZ5nsyLv5cSBGEgMTI","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"號10樓","short_name":"號10樓","types":["subpremise"]},{"long_name":"301","short_name":"301","types":["street_number"]},{"long_name":"台灣大道三段","short_name":"台灣大道三段","types":["route"]},{"long_name":"惠來里","short_name":"惠來里","types":["administrative_area_level_4","political"]},{"long_name":"西屯區","short_name":"西屯區","types":["administrative_area_level_3","political"]},{"long_name":"台中市","short_name":"台中市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"407","short_name":"407","types":["postal_code"]}],"formatted_address":"號10樓, No. 301台灣大道三段西屯區台中市台灣 407","geometry":{"location":{"lat":24.1652972,"lng":120.6437528},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.1667684802915,"lng":120.6451820802915},"southwest":{"lat":24.1640705197085,"lng":120.6424841197085}}},"place_id":"ChIJQaGZuow9aTQRMMOPbNE6ug4","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"11樓","short_name":"11樓","types":["subpremise"]},{"long_name":"726號","short_name":"726號","types":["street_number"]},{"long_name":"垂楊路","short_name":"垂楊路","types":["route"]},{"long_name":"永和里","short_name":"永和里","types":["administrative_area_level_4","political"]},{"long_name":"西區","short_name":"西區","types":["administrative_area_level_3","political"]},{"long_name":"嘉義市","short_name":"嘉義市","types":["administrative_area_level_2","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"600","short_name":"600","types":["postal_code"]}],"formatted_address":"600台灣嘉義市西區垂楊路726號11樓","geometry":{"location":{"lat":23.4736912,"lng":120.4410656},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":23.4747487802915,"lng":120.4424292302915},"southwest":{"lat":23.4720508197085,"lng":120.4397312697085}}},"place_id":"ChIJAZg_hCaUbjQR4RdLf40KpVM","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"8 樓","short_name":"8 樓","types":["subpremise"]},{"long_name":"新光 三越 店","short_name":"新光 三越 店","types":["establishment","point_of_interest"]},{"long_name":"123","short_name":"123","types":["street_number"]},{"long_name":"高鐵路","short_name":"高鐵路","types":["route"]},{"long_name":"左營","short_name":"左營","types":["neighborhood","political"]},{"long_name":"左營區","short_name":"左營區","types":["administrative_area_level_3","political"]},{"long_name":"高雄市","short_name":"高雄市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"813","short_name":"813","types":["postal_code"]}],"formatted_address":"813台灣高雄市左營區高鐵路123號新光 三越 店8 樓","geometry":{"location":{"lat":22.6892697,"lng":120.3107261},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":22.6905624302915,"lng":120.3121490802915},"southwest":{"lat":22.6878644697085,"lng":120.3094511197085}}},"place_id":"ChIJj7CFYWUFbjQR3ERGVRErfQc","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"12樓","short_name":"12樓","types":["subpremise"]},{"long_name":"162號","short_name":"162號","types":["street_number"]},{"long_name":"中山路","short_name":"中山路","types":["route"]},{"long_name":"公正里","short_name":"公正里","types":["administrative_area_level_4","political"]},{"long_name":"中西區","short_name":"中西區","types":["administrative_area_level_3","political"]},{"long_name":"台南市","short_name":"台南市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"700","short_name":"700","types":["postal_code"]}],"formatted_address":"700台灣台南市中西區中山路162號12樓","geometry":{"location":{"lat":22.9955137,"lng":120.2098312},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":22.9968928802915,"lng":120.2111681302915},"southwest":{"lat":22.9941949197085,"lng":120.2084701697085}}},"place_id":"ChIJy_gu74t2bjQRMFTOCBbUNRY","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"3 樓","short_name":"3 樓","types":["subpremise"]},{"long_name":"1-1","short_name":"1-1","types":["street_number"]},{"long_name":"中安路","short_name":"中安路","types":["route"]},{"long_name":"明正里","short_name":"明正里","types":["administrative_area_level_4","political"]},{"long_name":"前鎮區","short_name":"前鎮區","types":["administrative_area_level_3","political"]},{"long_name":"高雄市","short_name":"高雄市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"806","short_name":"806","types":["postal_code"]}],"formatted_address":"806台灣高雄市前鎮區中安路1-1號3 樓","geometry":{"location":{"lat":22.5826665,"lng":120.3309539},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":22.5839483802915,"lng":120.3323499302915},"southwest":{"lat":22.5812504197085,"lng":120.3296519697085}}},"place_id":"ChIJK98DHDoDbjQRhWuhqUKTj64","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"B2","short_name":"B2","types":["subpremise"]},{"long_name":"57","short_name":"57","types":["street_number"]},{"long_name":"五福三路","short_name":"五福三路","types":["route"]},{"long_name":"文西里","short_name":"文西里","types":["administrative_area_level_4","political"]},{"long_name":"前金區","short_name":"前金區","types":["administrative_area_level_3","political"]},{"long_name":"高雄市","short_name":"高雄市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"801","short_name":"801","types":["postal_code"]}],"formatted_address":"801台灣高雄市前金區五福三路57號B2","geometry":{"location":{"lat":22.6216729,"lng":120.2983545},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":22.6231134802915,"lng":120.2997409802915},"southwest":{"lat":22.62041551970849,"lng":120.2970430197085}}},"place_id":"ChIJayDJs4AEbjQROJkX8E3KcYw","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"4樓","short_name":"4樓","types":["subpremise"]},{"long_name":"777號","short_name":"777號","types":["street_number"]},{"long_name":"博愛二路","short_name":"博愛二路","types":["route"]},{"long_name":"新下里","short_name":"新下里","types":["administrative_area_level_4","political"]},{"long_name":"左營區","short_name":"左營區","types":["administrative_area_level_3","political"]},{"long_name":"高雄市","short_name":"高雄市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"813","short_name":"813","types":["postal_code"]}],"formatted_address":"813台灣高雄市左營區博愛二路777號4樓","geometry":{"location":{"lat":22.6697561,"lng":120.3025183},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":22.67108343029151,"lng":120.3042678302915},"southwest":{"lat":22.6683854697085,"lng":120.3015698697085}}},"place_id":"ChIJd2ZFrwgFbjQR4TYlbvSOud4","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"357-1","short_name":"357-1","types":["street_number"]},{"long_name":"明誠二路","short_name":"明誠二路","types":["route"]},{"long_name":"新上里","short_name":"新上里","types":["administrative_area_level_4","political"]},{"long_name":"左營區","short_name":"左營區","types":["administrative_area_level_3","political"]},{"long_name":"高雄市","short_name":"高雄市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"813","short_name":"813","types":["postal_code"]}],"formatted_address":"813台灣高雄市左營區明誠二路357-1號","geometry":{"location":{"lat":22.6608957,"lng":120.3082233},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":22.6622734802915,"lng":120.3095732302915},"southwest":{"lat":22.65957551970849,"lng":120.3068752697085}}},"place_id":"ChIJSz2BOgMFbjQR--40AoawP2Y","plus_code":{"compound_code":"M865+97 台灣高雄市左營區","global_code":"7QJ2M865+97"},"types":["street_address"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"樓C區","short_name":"樓C區","types":["subpremise"]},{"long_name":"12號2","short_name":"12號2","types":["street_number"]},{"long_name":"學城路一段","short_name":"學城路一段","types":["route"]},{"long_name":"三和里","short_name":"三和里","types":["administrative_area_level_4","political"]},{"long_name":"大樹區","short_name":"大樹區","types":["administrative_area_level_3","political"]},{"long_name":"高雄市","short_name":"高雄市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"840","short_name":"840","types":["postal_code"]}],"formatted_address":"840台灣高雄市大樹區學城路一段12號2號樓C區","geometry":{"location":{"lat":22.7302634,"lng":120.4026345},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":22.7314735302915,"lng":120.4039436302915},"southwest":{"lat":22.7287755697085,"lng":120.4012456697085}}},"partial_match":true,"place_id":"ChIJ5XmnahsRbjQRFJaDixGGbhI","types":["subpremise"]},{"address_components":[{"long_name":"樓C區","short_name":"樓C區","types":["subpremise"]},{"long_name":"12號","short_name":"12號","types":["street_number"]},{"long_name":"學城路一段","short_name":"學城路一段","types":["route"]},{"long_name":"三和里","short_name":"三和里","types":["administrative_area_level_4","political"]},{"long_name":"大樹區","short_name":"大樹區","types":["administrative_area_level_3","political"]},{"long_name":"高雄市","short_name":"高雄市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"840","short_name":"840","types":["postal_code"]}],"formatted_address":"840台灣高雄市大樹區學城路一段12號樓C區","geometry":{"location":{"lat":22.7303876,"lng":120.402402},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":22.7318271802915,"lng":120.4037823802915},"southwest":{"lat":22.7291292197085,"lng":120.4010844197085}}},"partial_match":true,"place_id":"ChIJZaFkPxsRbjQRL0SWIIS9FlU","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"號B3","short_name":"號B3","types":["subpremise"]},{"long_name":"266-1","short_name":"266-1","types":["street_number"]},{"long_name":"成功一路","short_name":"成功一路","types":["route"]},{"long_name":"榮復里","short_name":"榮復里","types":["administrative_area_level_4","political"]},{"long_name":"前金區","short_name":"前金區","types":["administrative_area_level_3","political"]},{"long_name":"高雄市","short_name":"高雄市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"801","short_name":"801","types":["postal_code"]}],"formatted_address":"801台灣高雄市前金區成功一路266-1號號B3","geometry":{"location":{"lat":22.6193366,"lng":120.2960446},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":22.6206276302915,"lng":120.2972305302915},"southwest":{"lat":22.6179296697085,"lng":120.2945325697085}}},"place_id":"ChIJn1bpyX8EbjQRjPTucqfxrT0","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"12F","short_name":"12F","types":["subpremise"]},{"long_name":"21","short_name":"21","types":["street_number"]},{"long_name":"三多四路","short_name":"三多四路","types":["route"]},{"long_name":"意誠里","short_name":"意誠里","types":["administrative_area_level_4","political"]},{"long_name":"苓雅區","short_name":"苓雅區","types":["administrative_area_level_3","political"]},{"long_name":"高雄市","short_name":"高雄市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"802","short_name":"802","types":["postal_code"]}],"formatted_address":"802台灣高雄市苓雅區三多四路21號12F","geometry":{"location":{"lat":22.6130987,"lng":120.3039755},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":22.6147378302915,"lng":120.3052102302915},"southwest":{"lat":22.6120398697085,"lng":120.3025122697085}}},"place_id":"ChIJIQgOzn0DbjQREnocZVmjFAY","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"6樓","short_name":"6樓","types":["subpremise"]},{"long_name":"658號","short_name":"658號","types":["street_number"]},{"long_name":"西門路一段","short_name":"西門路一段","types":["route"]},{"long_name":"小西里","short_name":"小西里","types":["administrative_area_level_4","political"]},{"long_name":"中西區","short_name":"中西區","types":["administrative_area_level_3","political"]},{"long_name":"台南市","short_name":"台南市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"700","short_name":"700","types":["postal_code"]}],"formatted_address":"700台灣台南市中西區西門路一段658號6樓","geometry":{"location":{"lat":22.9868032,"lng":120.1982502},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":22.9881409802915,"lng":120.1992674302915},"southwest":{"lat":22.9854430197085,"lng":120.1965694697085}}},"place_id":"ChIJK0Cg5nt2bjQRcJQMKdQNQHc","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"B1樓","short_name":"B1樓","types":["subpremise"]},{"long_name":"789號","short_name":"789號","types":["street_number"]},{"long_name":"中華五路","short_name":"中華五路","types":["route"]},{"long_name":"興邦里","short_name":"興邦里","types":["administrative_area_level_4","political"]},{"long_name":"前鎮區","short_name":"前鎮區","types":["administrative_area_level_3","political"]},{"long_name":"高雄市","short_name":"高雄市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"806","short_name":"806","types":["postal_code"]}],"formatted_address":"806台灣高雄市前鎮區中華五路789號B1樓","geometry":{"location":{"lat":22.5953346,"lng":120.3069499},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":22.5966835802915,"lng":120.3082988802915},"southwest":{"lat":22.59398561970849,"lng":120.3056009197085}}},"place_id":"ChIJ2fzV73IDbjQRcIZ3ml7rlbI","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"12樓","short_name":"12樓","types":["subpremise"]},{"long_name":"213號","short_name":"213號","types":["street_number"]},{"long_name":"三多三路","short_name":"三多三路","types":["route"]},{"long_name":"盛興里","short_name":"盛興里","types":["administrative_area_level_4","political"]},{"long_name":"前鎮區","short_name":"前鎮區","types":["administrative_area_level_3","political"]},{"long_name":"高雄市","short_name":"高雄市","types":["administrative_area_level_1","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"806","short_name":"806","types":["postal_code"]}],"formatted_address":"806台灣高雄市前鎮區三多三路213號12樓","geometry":{"location":{"lat":22.6144461,"lng":120.3067782},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":22.6159041302915,"lng":120.3080845302915},"southwest":{"lat":22.6132061697085,"lng":120.3053865697085}}},"place_id":"ChIJKZtNe30DbjQRds0VhXXSZSk","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"2F","short_name":"2F","types":["subpremise"]},{"long_name":"80號","short_name":"80號","types":["street_number"]},{"long_name":"中華路","short_name":"中華路","types":["route"]},{"long_name":"興樂里","short_name":"興樂里","types":["administrative_area_level_4","political"]},{"long_name":"屏東市","short_name":"屏東市","types":["administrative_area_level_3","political"]},{"long_name":"屏東縣","short_name":"屏東縣","types":["administrative_area_level_2","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"900","short_name":"900","types":["postal_code"]}],"formatted_address":"900台灣屏東縣屏東市中華路80號2F","geometry":{"location":{"lat":22.6740893,"lng":120.4906227},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":22.67544438029151,"lng":120.4919506302915},"southwest":{"lat":22.6727464197085,"lng":120.4892526697085}}},"place_id":"ChIJWzwl35oXbjQRP1wrGZlUPtI","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"4樓","short_name":"4樓","types":["subpremise"]},{"long_name":"38巷6號","short_name":"38巷6號","types":["street_number"]},{"long_name":"民權路二段","short_name":"民權路二段","types":["route"]},{"long_name":"南門里","short_name":"南門里","types":["administrative_area_level_4","political"]},{"long_name":"宜蘭市","short_name":"宜蘭市","types":["administrative_area_level_3","political"]},{"long_name":"宜蘭縣","short_name":"宜蘭縣","types":["administrative_area_level_2","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"260","short_name":"260","types":["postal_code"]}],"formatted_address":"260台灣宜蘭縣宜蘭市民權路二段38巷6號4樓","geometry":{"location":{"lat":24.7540596,"lng":121.7505349},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.75510498029151,"lng":121.7517642802915},"southwest":{"lat":24.7524070197085,"lng":121.7490663197085}}},"place_id":"ChIJZdiBhMPkZzQRVCbFfxAV9sE","types":["subpremise"]}],"status":"OK"}, 
        {"results":[{"address_components":[{"long_name":"4樓","short_name":"4樓","types":["subpremise"]},{"long_name":"38巷6號","short_name":"38巷6號","types":["street_number"]},{"long_name":"民權路二段","short_name":"民權路二段","types":["route"]},{"long_name":"南門里","short_name":"南門里","types":["administrative_area_level_4","political"]},{"long_name":"宜蘭市","short_name":"宜蘭市","types":["administrative_area_level_3","political"]},{"long_name":"宜蘭縣","short_name":"宜蘭縣","types":["administrative_area_level_2","political"]},{"long_name":"台灣","short_name":"TW","types":["country","political"]},{"long_name":"260","short_name":"260","types":["postal_code"]}],"formatted_address":"260台灣宜蘭縣宜蘭市民權路二段38巷6號4樓","geometry":{"location":{"lat":23.7540596,"lng":121.7505349},"location_type":"ROOFTOP","viewport":{"northeast":{"lat":24.75510498029151,"lng":121.7517642802915},"southwest":{"lat":24.7524070197085,"lng":121.7490663197085}}},"place_id":"ChIJZdiBhMPkZzQRVCbFfxAV9sE","types":["subpremise"]}],"status":"OK"}, 
      ];
      return { geoencodingRaw: mockRaws[i], pointData: mapData}
    })
  })

  convertAddressToRawGeoencoding = mergeMap( (next: GoogleSheetPin[]): Observable<GoogleSheetPinMappingGeoencodingRaw[]>=> {
    // next = next.filter( (v,i) => i < 20)
    let allRequests = next.map(pointData => {      
      const encodedAddress = encodeURIComponent(pointData.address)
      const request = this.getGeoLonLat(encodedAddress, pointData)
      return request
    });    
    const groups = this.groupRequest(allRequests)
    return from(groups).pipe( 
      concatMap( group => {
        return from(group).pipe( 
          delay(250),
          tap( val => console.log('delayeed')),
          mergeMap( rq => rq),
        )
      }),
      toArray(),
    )
  })

  groupRequest = (rqs:Observable<GoogleSheetPinMappingGeoencodingRaw>[]): Observable<GoogleSheetPinMappingGeoencodingRaw>[][] => {
    const groups = []        
    for (let i = 0; i < rqs.length; i+=3) {
      const emptyGroup = new Array(3).fill(i)
      const mappedGroup = emptyGroup.map( (groupId, index) => rqs[groupId + index])
      const solidGroup = mappedGroup.filter( (rq) => Boolean(rq) )
      groups.push(solidGroup)
    }    
    return groups
  }


  getGeoLonLat = (address: string, pointData: GoogleSheetPin): Observable<GoogleSheetPinMappingGeoencodingRaw> => {
    return this.httpClient.get<GeoencodingRaw>(`https://maps.googleapis.com/maps/api/geocode/json?address=${address}&key=AIzaSyAAQr-IWEpmXbcOk3trYWMMcasLuIBZ280`)
    .pipe( map( raw => {
      return {geoencodingRaw: raw, pointData
      }}))
  }

  convertGeoencodingToLonLat = map( (points: GoogleSheetPinMappingGeoencodingRaw[]): GoogleSheetPinMappingLonLat[] => {
    return points.map( point => {      
      const location = point.geoencodingRaw.results[0].geometry.location      
      return {lonLat: new Vector2(location.lng, location.lat), pinData: point.pointData}
    })
  })

  getAddressCache = (id: number) => {
    return this.httpClient.get(`${this.getFrontEndUrl()}/address/${id}`, { headers: this.createHeader()})
  }

  getAddressCaches = () => {
    return this.httpClient.get(`${this.getFrontEndUrl()}/address`, { headers: this.createHeader()})
  }

  addAddressCache = (address: GoogleSheetPinMappingLonLat) => {
    const body = new URLSearchParams()
    body.set("lat", address.lonLat.y.toString())
    body.set("lon", address.lonLat.x.toString())
    body.set("title", address.pinData.title)
    body.set("address", address.pinData.address)
    return this.httpClient.post<{message:string}>(`${this.getFrontEndUrl()}/address`, body.toString(), { headers: this.createHeader() })
  }

  updatePinSheetId = (mapId: number, sheetId:string) => {
    const body = new URLSearchParams()
    body.set("sheetId", sheetId)
    return this.httpClient.post<{message:string}>(`${this.getFrontEndUrl()}/maps/${mapId}/pinSheet`, body.toString(), { headers: this.createHeader()})
  }

}
